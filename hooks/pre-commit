#!/bin/sh
# Cheatsheet Generator Pre-commit Hook
# Auto-generated by cheatsheet_generator.nvim

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "Warning: Not in a git repository, skipping cheatsheet generation"
    exit 0
fi

# Generate the cheatsheet
echo "Generating cheatsheet..."
nvim --headless -c "lua require('cheatsheet_generator').generate_with_context('pre-commit')" -c "qa"

# Check if generation was successful
if [ $? -eq 0 ]; then
    # Check if CHEATSHEET.md was modified
    if git diff --quiet HEAD -- CHEATSHEET.md 2>/dev/null; then
        echo "Cheatsheet is up to date"
    else
        echo "Cheatsheet updated, adding to commit"
        git add CHEATSHEET.md
    fi
else
    echo "Warning: Cheatsheet generation failed"
    # Don't fail the commit, just warn
fi

exit 0
